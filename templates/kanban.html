{% extends "base.html" %}

{% block title %}Kanban Board - GearGuard{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Maintenance Kanban Board</h2>
</div>

<div class="kanban-board">
    <!-- New Column -->
    <div class="kanban-column" data-status="New">
        <div class="column-header">
            <h3>New</h3>
            <span class="badge">{{ new_requests|length }}</span>
        </div>
        <div class="kanban-cards" id="column-new">
            {% for req in new_requests %}
            <div class="kanban-card {% if req.is_overdue() %}overdue{% endif %}" draggable="true" data-request-id="{{ req.id }}">
                <h4>{{ req.subject }}<span class="status-badge status-{{ req.priority | lower }}">{{ req.priority }}</span></h4>
                <p class="card-equipment">ğŸ”§ {{ req.equipment.equipment_name }}</p>
                <p class="card-tech">ğŸ‘¤ {{ req.assigned_technician.name if req.assigned_technician else 'Unassigned' }}</p>
                <p class="card-type">{{ req.request_type }}</p>
                {% if req.scheduled_date %}
                <p class="card-date">ğŸ“… {{ req.scheduled_date.strftime('%Y-%m-%d') }}</p>
                {% endif %}
                {% if req.is_overdue() %}
                <span class="overdue-badge">OVERDUE</span>
                {% endif %}
                <div class="card-actions">
                    <a href="{{ url_for('requests.edit', id=req.id) }}" class="btn-small">Edit</a>
                    <form method="POST"
      action="{{ url_for('requests.delete_request', id=req.id) }}"
      style="display:inline;"
      onsubmit="return confirm('Are you sure you want to delete this request?');">
      
    <button type="submit" class="btn-small btn-danger">
        ğŸ—‘ Delete
    </button>
</form>
   </div>
                

            </div>
            {% endfor %}
        </div>
    </div>

    <!-- In Progress Column -->
    <div class="kanban-column" data-status="In Progress">
        <div class="column-header">
            <h3>In Progress</h3>
            <span class="badge">{{ in_progress_requests|length }}</span>
        </div>
        <div class="kanban-cards" id="column-in-progress">
            {% for req in in_progress_requests %}
            <div class="kanban-card {% if req.is_overdue() %}overdue{% endif %}" draggable="true" data-request-id="{{ req.id }}">
                <h4>{{ req.subject }}</h4>
                <p class="card-equipment">ğŸ”§ {{ req.equipment.equipment_name }}</p>
                <p class="card-tech">ğŸ‘¤ {{ req.assigned_technician.name if req.assigned_technician else 'Unassigned' }}</p>
                <p class="card-type">{{ req.request_type }}</p>
                {% if req.scheduled_date %}
                <p class="card-date">ğŸ“… {{ req.scheduled_date.strftime('%Y-%m-%d') }}</p>
                {% endif %}
                {% if req.is_overdue() %}
                <span class="overdue-badge">OVERDUE</span>
                {% endif %}
                <div class="card-actions">
                    <a href="{{ url_for('requests.edit', id=req.id) }}" class="btn-small">Edit</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Repaired Column -->
    <div class="kanban-column" data-status="Repaired">
        <div class="column-header">
            <h3>Repaired</h3>
            <span class="badge">{{ repaired_requests|length }}</span>
        </div>
        <div class="kanban-cards" id="column-repaired">
            {% for req in repaired_requests %}
            <div class="kanban-card" draggable="true" data-request-id="{{ req.id }}">
                <h4>{{ req.subject }}</h4>
                <p class="card-equipment">ğŸ”§ {{ req.equipment.equipment_name }}</p>
                <p class="card-tech">ğŸ‘¤ {{ req.assigned_technician.name if req.assigned_technician else 'Unassigned' }}</p>
                <p class="card-type">{{ req.request_type }}</p>
                {% if req.duration_hours %}
                <p class="card-duration">â±ï¸ {{ req.duration_hours }}h</p>
                {% endif %}
                <div class="card-actions">
                    <a href="{{ url_for('requests.edit', id=req.id) }}" class="btn-small">Edit</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Scrap Column -->
    <div class="kanban-column" data-status="Scrap">
        <div class="column-header">
            <h3>Scrap</h3>
            <span class="badge">{{ scrap_requests|length }}</span>
        </div>
        <div class="kanban-cards" id="column-scrap">
            {% for req in scrap_requests %}
            <div class="kanban-card scrap" draggable="true" data-request-id="{{ req.id }}">
                <h4>{{ req.subject }}</h4>
                <p class="card-equipment">ğŸ”§ {{ req.equipment.equipment_name }}</p>
                <p class="card-tech">ğŸ‘¤ {{ req.assigned_technician.name if req.assigned_technician else 'Unassigned' }}</p>
                <p class="card-type">{{ req.request_type }}</p>
                <div class="card-actions">
                    <a href="{{ url_for('requests.edit', id=req.id) }}" class="btn-small">View</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/kanban.js') }}"></script>
{% endblock %}